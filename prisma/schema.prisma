// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================
// USER MANAGEMENT
// ============================================

enum UserRole {
  LANDOWNER
  RENTER
  BUYER
  SELLER
  ORGANIZATION
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  INACTIVE
}

model User {
  id                String      @id @default(cuid())
  clerkId           String      @unique
  email             String      @unique
  username          String?     @unique
  firstName         String
  lastName          String
  phoneNumber       String?
  avatar            String?
  coverImage        String?
  bio               String?
  location          String?
  website           String?
  socialLinks       Json?
  role              UserRole[]  @default([RENTER])
  status            UserStatus  @default(ACTIVE)

  // Verification
  isVerified        Boolean     @default(false)
  verifiedAt        DateTime?
  isPhoneVerified   Boolean     @default(false)
  phoneVerifiedAt   DateTime?
  isIdVerified      Boolean     @default(false)
  idVerifiedAt      DateTime?

  // Privacy Settings
  profileVisibility String      @default("PUBLIC") // PUBLIC, FOLLOWERS, PRIVATE
  allowMessages     String      @default("EVERYONE") // EVERYONE, FOLLOWERS, NONE

  // Onboarding
  onboardingComplete Boolean    @default(false)
  interests          String[]   @default([])
  experienceLevel    String?

  // Gamification
  totalPoints       Int         @default(0)
  level             Int         @default(1)

  // Preferences
  preferredLanguage String      @default("en")
  timezone          String      @default("America/New_York")

  // Stripe Integration
  stripeCustomerId         String?  @unique
  stripeConnectId          String?  @unique
  stripeOnboardingComplete Boolean  @default(false)

  // Instructor Status
  isInstructor             Boolean  @default(false)
  instructorApprovedAt     DateTime?

  // Timestamps
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  lastLoginAt       DateTime?

  // Relations
  ownedPlots        Plot[]              @relation("PlotOwner")
  rentedPlots       Booking[]           @relation("PlotRenter")
  cropJournals      CropJournal[]
  userBadges        UserBadge[]
  courseProgress    CourseProgress[]
  sentMessages      Message[]           @relation("MessageSender")
  receivedMessages  Message[]           @relation("MessageReceiver")
  reviews           Review[]            @relation("ReviewAuthor")
  receivedReviews   Review[]            @relation("ReviewSubject")
  produceListings   ProduceListing[]
  orders            Order[]
  activities        UserActivity[]
  notifications     Notification[]
  posts             UserPost[]
  postComments      PostComment[]
  following         Follow[]         @relation("UserFollowing")
  followers         Follow[]         @relation("UserFollowers")
  ownedTools        Tool[]           @relation("ToolOwner")
  toolRentals       ToolRental[]     @relation("ToolRenter")
  forumTopics       ForumTopic[]
  forumReplies      ForumReply[]
  forumVotes        ForumVote[]
  reviewVotes       ReviewVote[]
  emailPreferences  EmailPreferences?
  notificationPreferences NotificationPreferences?
  verificationRequests VerificationRequest[]
  blockedUsers      BlockedUser[] @relation("UserBlocking")
  blockedByUsers    BlockedUser[] @relation("UserBlockedBy")
  savedSearches     SavedSearch[]

  // Instructor & Course Relations
  instructorApplication InstructorApplication?
  instructorCourses     Course[]          @relation("InstructorCourses")
  coursePurchases       CoursePurchase[]
  subscription          Subscription?
  instructorEvents      CourseEvent[]     @relation("InstructorEvents")
  eventAttendances      EventAttendee[]

  // Community Groups & Challenges
  createdGroups         CommunityGroup[]  @relation("GroupCreator")
  groupMemberships      GroupMember[]
  hostedGroupEvents     GroupEvent[]      @relation("GroupEventHost")
  groupEventAttendances GroupEventAttendee[]
  groupPosts            GroupPost[]       @relation("GroupPostAuthor")
  createdChallenges     Challenge[]       @relation("ChallengeCreator")
  challengeParticipations ChallengeParticipant[]

  // Community Tips
  communityTips         CommunityTip[]
  communityTipVotes     CommunityTipVote[]

  // Community Events
  organizedEvents       CommunityEvent[]      @relation("EventOrganizer")
  eventRSVPs            CommunityEventRSVP[]  @relation("EventRSVP")

  // Content Moderation
  reportsFiled          Report[]          @relation("ReportedBy")
  reportsReceived       Report[]          @relation("ReportedUser")

  // Disputes
  disputesFiled         BookingDispute[]  @relation("DisputeFiler")
  disputesResolved      BookingDispute[]  @relation("DisputeResolver")
  disputeMessages       DisputeMessage[]

  @@index([clerkId])
  @@index([email])
  @@index([username])
  @@index([status])
}

// ============================================
// VERIFICATION & PRIVACY
// ============================================

enum VerificationType {
  PHONE
  ID
  ADDRESS
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

model VerificationRequest {
  id          String             @id @default(cuid())
  userId      String
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        VerificationType
  status      VerificationStatus @default(PENDING)
  documentUrl String?            // For ID verification
  phoneCode   String?            // For phone verification (hashed)
  phoneCodeExpires DateTime?
  notes       String?            // Admin notes
  createdAt   DateTime           @default(now())
  reviewedAt  DateTime?
  reviewedBy  String?            // Admin user ID

  @@index([userId])
  @@index([status])
  @@index([type])
}

model BlockedUser {
  id        String   @id @default(cuid())
  blockerId String
  blocker   User     @relation("UserBlocking", fields: [blockerId], references: [id], onDelete: Cascade)
  blockedId String
  blocked   User     @relation("UserBlockedBy", fields: [blockedId], references: [id], onDelete: Cascade)
  reason    String?
  createdAt DateTime @default(now())

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@index([blockedId])
}

model SavedSearch {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  filters     Json     // Stores all search filters
  notifyOnNew Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}

// ============================================
// LAND & PLOT MANAGEMENT
// ============================================

enum PlotStatus {
  DRAFT
  ACTIVE
  RENTED
  INACTIVE
  ARCHIVED
}

enum SoilType {
  CLAY
  SANDY
  LOAM
  SILT
  PEAT
  CHALK
}

enum WaterAccess {
  NONE
  WELL
  MUNICIPAL
  POND
  STREAM
  IRRIGATION
}

model Plot {
  id                String        @id @default(cuid())
  ownerId           String
  owner             User          @relation("PlotOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  // Basic Info
  title             String
  description       String
  status            PlotStatus    @default(DRAFT)

  // Location
  address           String
  city              String
  state             String
  zipCode           String
  county            String?
  latitude          Float
  longitude         Float

  // Plot Details
  acreage           Float
  soilType          SoilType[]
  soilPH            Float?
  waterAccess       WaterAccess[]
  usdaZone          String?
  sunExposure       String?       // full, partial, shade

  // Features
  hasFencing        Boolean       @default(false)
  hasGreenhouse     Boolean       @default(false)
  hasToolStorage    Boolean       @default(false)
  hasElectricity    Boolean       @default(false)
  hasRoadAccess     Boolean       @default(false)
  hasIrrigation     Boolean       @default(false)
  isADAAccessible   Boolean       @default(false)

  // Additional Details
  allowsLivestock   Boolean       @default(false)
  allowsStructures  Boolean       @default(false)
  restrictions      String?

  // Pricing
  pricePerMonth     Float
  pricePerSeason    Float?
  pricePerYear      Float?
  securityDeposit   Float?

  // Booking
  instantBook       Boolean       @default(false)
  minimumLease      Int           @default(3)  // months

  // Media
  images            String[]
  droneFootageUrl   String?
  virtualTourUrl    String?

  // Stats
  viewCount         Int           @default(0)
  bookingCount      Int           @default(0)
  averageRating     Float?

  // Timestamps
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  publishedAt       DateTime?

  // Relations
  bookings          Booking[]
  amenities         PlotAmenity[]
  soilTests         SoilTest[]
  reviews           Review[]
  blockedDates      PlotBlockedDate[]
  reports           Report[]

  @@index([ownerId])
  @@index([status])
  @@index([city, state])
  @@index([latitude, longitude])
}

model PlotBlockedDate {
  id          String   @id @default(cuid())
  plotId      String
  plot        Plot     @relation(fields: [plotId], references: [id], onDelete: Cascade)
  startDate   DateTime
  endDate     DateTime
  reason      String?  // e.g., "maintenance", "personal use", "seasonal closure"
  createdAt   DateTime @default(now())

  @@index([plotId])
  @@index([startDate, endDate])
}

model PlotAmenity {
  id          String   @id @default(cuid())
  plotId      String
  plot        Plot     @relation(fields: [plotId], references: [id], onDelete: Cascade)
  name        String
  description String?
  price       Float?   // Optional add-on price
  createdAt   DateTime @default(now())

  @@index([plotId])
}

model SoilTest {
  id          String   @id @default(cuid())
  plotId      String
  plot        Plot     @relation(fields: [plotId], references: [id], onDelete: Cascade)
  testDate    DateTime
  pH          Float?
  nitrogen    Float?
  phosphorus  Float?
  potassium   Float?
  organicMatter Float?
  results     Json?    // Full test results
  pdfUrl      String?
  createdAt   DateTime @default(now())

  @@index([plotId])
}

// ============================================
// BOOKING & RENTAL MANAGEMENT
// ============================================

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
  ACTIVE
  COMPLETED
  CANCELLED
}

model Booking {
  id              String        @id @default(cuid())
  plotId          String
  plot            Plot          @relation(fields: [plotId], references: [id], onDelete: Cascade)
  renterId        String
  renter          User          @relation("PlotRenter", fields: [renterId], references: [id], onDelete: Cascade)

  status          BookingStatus @default(PENDING)

  // Dates
  startDate       DateTime
  endDate         DateTime

  // Pricing
  monthlyRate     Float
  totalAmount     Float
  securityDeposit Float?

  // Payment
  stripePaymentId String?
  paidAt          DateTime?

  // Agreement
  leaseUrl        String?
  signedAt        DateTime?

  // Check-in/out
  checkedInAt     DateTime?
  checkedOutAt    DateTime?

  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  approvedAt      DateTime?
  rejectedAt      DateTime?
  cancelledAt     DateTime?

  // Relations
  messages        Message[]
  paymentIntent   PaymentIntent?
  dispute         BookingDispute?

  @@index([plotId])
  @@index([renterId])
  @@index([status])
  @@index([startDate, endDate])
}

// ============================================
// DISPUTE RESOLUTION
// ============================================

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  RESOLVED
  CLOSED
}

enum DisputeReason {
  PROPERTY_NOT_AS_DESCRIBED
  ACCESS_ISSUES
  PAYMENT_DISPUTE
  EARLY_TERMINATION
  DAMAGE_CLAIM
  SAFETY_CONCERN
  COMMUNICATION_ISSUES
  OTHER
}

enum DisputeResolution {
  FULL_REFUND
  PARTIAL_REFUND
  NO_REFUND
  DEPOSIT_RETURNED
  DEPOSIT_FORFEITED
  MUTUAL_AGREEMENT
  DISMISSED
}

model BookingDispute {
  id              String            @id @default(cuid())
  bookingId       String            @unique
  booking         Booking           @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  // Who filed the dispute
  filedById       String
  filedBy         User              @relation("DisputeFiler", fields: [filedById], references: [id])

  // Dispute details
  reason          DisputeReason
  description     String
  evidence        String[]          // URLs to uploaded files/images
  requestedAmount Float?            // Amount in dispute

  // Status
  status          DisputeStatus     @default(OPEN)

  // Resolution
  resolution      DisputeResolution?
  resolutionNotes String?
  resolvedAmount  Float?
  resolvedById    String?
  resolvedBy      User?             @relation("DisputeResolver", fields: [resolvedById], references: [id])
  resolvedAt      DateTime?

  // Communication
  messages        DisputeMessage[]

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([filedById])
  @@index([status])
  @@index([createdAt])
}

model DisputeMessage {
  id          String         @id @default(cuid())
  disputeId   String
  dispute     BookingDispute @relation(fields: [disputeId], references: [id], onDelete: Cascade)
  senderId    String
  sender      User           @relation(fields: [senderId], references: [id])

  content     String
  attachments String[]

  isInternal  Boolean        @default(false) // Admin-only notes

  createdAt   DateTime       @default(now())

  @@index([disputeId])
  @@index([senderId])
}

// ============================================
// PAYMENT SYSTEM
// ============================================

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELLED
  REFUNDED
}

model PaymentIntent {
  id                    String        @id @default(cuid())
  stripePaymentIntentId String        @unique
  amount                Int           // Amount in cents
  currency              String        @default("usd")
  status                PaymentStatus @default(PENDING)

  // Related entities (one or the other)
  bookingId             String?       @unique
  booking               Booking?      @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  orderId               String?       @unique
  order                 Order?        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  // Metadata
  metadata              Json?
  failureMessage        String?

  // Timestamps
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  completedAt           DateTime?

  @@index([stripePaymentIntentId])
  @@index([status])
}

// ============================================
// GAMIFICATION SYSTEM
// ============================================

enum BadgeCategory {
  MILESTONE
  SKILL
  COMMUNITY
  PRODUCTION
  STEWARDSHIP
}

enum BadgeTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

model Badge {
  id          String        @id @default(cuid())
  name        String        @unique
  description String
  category    BadgeCategory
  tier        BadgeTier     @default(BRONZE)
  icon        String
  points      Int           @default(0)
  criteria    Json          // JSON describing how to earn this badge
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())

  // Relations
  userBadges  UserBadge[]
  challenges  Challenge[]

  @@index([category])
}

model UserBadge {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badgeId     String
  badge       Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  earnedAt    DateTime @default(now())

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
}

enum ActivityType {
  PLOT_LISTED
  PLOT_RENTED
  BOOKING_CREATED
  BOOKING_APPROVED
  BOOKING_REJECTED
  BOOKING_CANCELLED
  REVIEW_CREATED
  REVIEW_RECEIVED
  REVIEW_SUBMITTED
  FIRST_HARVEST
  JOURNAL_ENTRY
  COURSE_VIEWED
  COURSE_COMPLETED
  BADGE_EARNED
  PRODUCE_SOLD
  MILESTONE_REACHED
  POST_CREATED
  NEW_FOLLOWER
  ACHIEVEMENT_UNLOCKED
  TIP_SUBMITTED
  TIP_APPROVED
  EVENT_CREATED
  EVENT_RSVP
  GROUP_JOINED
  CHALLENGE_JOINED
  CHALLENGE_TASK_COMPLETED
  CHALLENGE_COMPLETED
}

model UserActivity {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        ActivityType
  title       String
  description String?
  points      Int          @default(0)
  metadata    Json?
  createdAt   DateTime     @default(now())

  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

// ============================================
// CROP JOURNAL & FARMING TRACKING
// ============================================

enum CropStage {
  PLANNING
  PLANTED
  GERMINATED
  GROWING
  FLOWERING
  FRUITING
  HARVESTING
  COMPLETED
}

model CropJournal {
  id              String     @id @default(cuid())
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Crop Info
  cropName        String
  variety         String?
  plantedDate     DateTime?
  expectedHarvest DateTime?
  stage           CropStage  @default(PLANNING)

  // Journal Entry
  title           String
  content         String
  images          String[]

  // Tracking
  plantCount      Int?
  areaUsed        Float?     // square feet

  // Weather Data
  weatherData     Json?
  weatherLocation String?

  // Timestamps
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relations
  harvests        Harvest[]

  @@index([userId])
  @@index([stage])
}

model Harvest {
  id              String      @id @default(cuid())
  cropJournalId   String
  cropJournal     CropJournal @relation(fields: [cropJournalId], references: [id], onDelete: Cascade)

  harvestDate     DateTime
  quantity        Float       // in pounds
  quality         String?     // excellent, good, fair, poor
  notes           String?

  createdAt       DateTime    @default(now())

  @@index([cropJournalId])
  @@index([harvestDate])
}

// ============================================
// KNOWLEDGE HUB & EDUCATION
// ============================================

enum CourseCategory {
  SOIL_SCIENCE
  CROP_GUIDES
  PEST_MANAGEMENT
  FARMING_METHODS
  ANIMAL_HUSBANDRY
  BUSINESS_LEGAL
  CLIMATE_ADAPTATION
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model Course {
  id              String           @id @default(cuid())
  title           String
  slug            String?          @unique
  description     String
  category        CourseCategory
  level           CourseLevel      @default(BEGINNER)

  // Instructor
  instructorId    String?
  instructor      User?            @relation("InstructorCourses", fields: [instructorId], references: [id], onDelete: SetNull)

  // Content
  thumbnailUrl    String?
  duration        Int?             // minutes
  pointsAwarded   Int              @default(0)

  // Pricing & Access
  accessType      CourseAccessType @default(FREE)
  price           Float?           // One-time price in dollars
  includeInSubscription Boolean    @default(false)

  // Certification
  isCertification Boolean          @default(false)
  certificateName String?

  isPublished     Boolean          @default(false)

  // Stats
  viewCount       Int              @default(0)

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  publishedAt     DateTime?

  // Relations
  modules         CourseModule[]
  progress        CourseProgress[]
  purchases       CoursePurchase[]
  events          CourseEvent[]
  views           CourseView[]

  @@index([category])
  @@index([isPublished])
  @@index([instructorId])
  @@index([slug])
  @@index([accessType])
}

model CourseModule {
  id          String   @id @default(cuid())
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  title       String
  description String?
  content     String   // Markdown or HTML
  videoUrl    String?
  order       Int

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([courseId])
}

model CourseProgress {
  id                 String    @id @default(cuid())
  userId             String
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId           String
  course             Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)

  startedAt          DateTime  @default(now())
  completedAt        DateTime?
  progressPercent    Int       @default(0)
  isCompleted        Boolean   @default(false)
  completedModuleIds String[]  @default([])
  updatedAt          DateTime  @updatedAt

  // Certificate (only for certification courses)
  certificateId      String?   @unique
  certificateIssuedAt DateTime?

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
  @@index([certificateId])
}

model CourseView {
  id          String   @id @default(cuid())
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // Track by user if logged in, otherwise by session/IP
  userId      String?
  sessionId   String?  // For anonymous users

  // Track viewing date to allow re-counting after a day
  viewedAt    DateTime @default(now())
  viewDate    String   // YYYY-MM-DD format for easy daily deduplication

  @@unique([courseId, userId, viewDate])
  @@unique([courseId, sessionId, viewDate])
  @@index([courseId])
  @@index([userId])
  @@index([viewDate])
}

// ============================================
// INSTRUCTOR SYSTEM
// ============================================

enum InstructorApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

model InstructorApplication {
  id            String                      @id @default(cuid())
  userId        String                      @unique
  user          User                        @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Application details
  expertise     String[]                    // Areas of expertise
  experience    String                      // Teaching/farming experience
  bio           String                      // Instructor bio
  portfolioUrl  String?                     // Optional portfolio/website
  socialLinks   Json?                       // YouTube, LinkedIn, etc.

  status        InstructorApplicationStatus @default(PENDING)

  // Admin review
  reviewedBy    String?
  reviewNotes   String?
  reviewedAt    DateTime?

  createdAt     DateTime                    @default(now())
  updatedAt     DateTime                    @updatedAt

  @@index([userId])
  @@index([status])
}

// ============================================
// COURSE MONETIZATION
// ============================================

enum CourseAccessType {
  FREE
  ONE_TIME
  SUBSCRIPTION
  BOTH
}

model CoursePurchase {
  id                 String   @id @default(cuid())
  userId             String
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId           String
  course             Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  // Purchase details
  amount             Float    // Amount paid in dollars
  platformFee        Float    // 10% platform fee
  instructorEarnings Float    // 90% to instructor

  status             String   @default("PENDING") // PENDING, COMPLETED, REFUNDED
  stripePaymentId    String?

  // Timestamps
  purchasedAt        DateTime @default(now())
  refundedAt         DateTime?

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
  @@index([status])
}

model Subscription {
  id                   String   @id @default(cuid())
  userId               String   @unique
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Stripe subscription details
  stripeSubscriptionId String   @unique
  stripePriceId        String
  stripeCustomerId     String

  // Subscription status
  status               String   @default("active") // active, canceled, past_due
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  cancelAtPeriodEnd    Boolean  @default(false)

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

// ============================================
// COURSE EVENTS & CALENDAR
// ============================================

enum EventType {
  LIVE_SESSION
  WEBINAR
  QA_SESSION
  OFFICE_HOURS
  COURSE_RELEASE
  DEADLINE
}

model CourseEvent {
  id           String      @id @default(cuid())
  courseId     String?
  course       Course?     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  instructorId String
  instructor   User        @relation("InstructorEvents", fields: [instructorId], references: [id], onDelete: Cascade)

  title        String
  description  String?
  type         EventType

  // Timing
  startTime    DateTime
  endTime      DateTime
  timezone     String      @default("America/New_York")

  // Live session details
  meetingUrl   String?     // Zoom, Google Meet, etc.
  maxAttendees Int?

  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  attendees    EventAttendee[]

  @@index([courseId])
  @@index([instructorId])
  @@index([startTime])
  @@index([type])
}

model EventAttendee {
  id                    String      @id @default(cuid())
  eventId               String
  event                 CourseEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId                String
  user                  User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Google Calendar integration
  googleCalendarEventId String?

  registeredAt          DateTime    @default(now())

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

// ============================================
// COMMUNITY EVENTS
// ============================================

enum CommunityEventCategory {
  WORKSHOP
  SEED_SWAP
  FARMERS_MARKET
  VOLUNTEER_DAY
  MEETUP
  TOUR
  CLASS
  HARVEST_FESTIVAL
  OTHER
}

model CommunityEvent {
  id            String                 @id @default(cuid())
  organizerId   String
  organizer     User                   @relation("EventOrganizer", fields: [organizerId], references: [id], onDelete: Cascade)

  title         String
  description   String
  category      CommunityEventCategory
  image         String?

  // Timing
  startDate     DateTime
  endDate       DateTime?
  timezone      String                 @default("America/Los_Angeles")

  // Location
  location      String                 // Venue name
  address       String
  city          String
  state         String
  latitude      Float?
  longitude     Float?
  isVirtual     Boolean                @default(false)
  virtualLink   String?

  // Capacity & Pricing
  capacity      Int?
  price         Float                  @default(0) // 0 = free

  // Additional Info
  tags          String[]
  requirements  String[]
  whatToBring   String[]

  // Status
  isFeatured    Boolean                @default(false)
  isPublished   Boolean                @default(true)
  isCancelled   Boolean                @default(false)

  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt

  // Relations
  attendees     CommunityEventRSVP[]

  @@index([organizerId])
  @@index([startDate])
  @@index([category])
  @@index([city, state])
}

model CommunityEventRSVP {
  id            String          @id @default(cuid())
  eventId       String
  event         CommunityEvent  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId        String
  user          User            @relation("EventRSVP", fields: [userId], references: [id], onDelete: Cascade)

  status        RSVPStatus      @default(GOING)
  registeredAt  DateTime        @default(now())

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

enum RSVPStatus {
  GOING
  INTERESTED
  CANCELLED
}

// ============================================
// MESSAGING SYSTEM
// ============================================

model Message {
  id          String   @id @default(cuid())
  senderId    String
  sender      User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiverId  String
  receiver    User     @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  bookingId   String?
  booking     Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  subject     String?
  content     String

  isRead      Boolean  @default(false)
  readAt      DateTime?

  // Reports
  reports     Report[]

  createdAt   DateTime @default(now())

  @@index([senderId])
  @@index([receiverId])
  @@index([bookingId])
  @@index([createdAt])
}

// ============================================
// NOTIFICATION SYSTEM
// ============================================

enum NotificationType {
  BOOKING_REQUEST
  BOOKING_APPROVED
  BOOKING_REJECTED
  BOOKING_CANCELLED
  NEW_MESSAGE
  NEW_REVIEW
  PAYMENT_RECEIVED
  PLOT_VIEWED
  SYSTEM
  SUBSCRIPTION_UPDATED
  INSTRUCTOR_APPROVED
  INSTRUCTOR_REJECTED
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      NotificationType
  title     String
  content   String
  link      String?

  isRead    Boolean          @default(false)
  readAt    DateTime?

  metadata  Json?

  createdAt DateTime         @default(now())

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

// ============================================
// REVIEW & RATING SYSTEM
// ============================================

enum ReviewType {
  PLOT
  USER
  TOOL_RENTAL
}

model Review {
  id          String       @id @default(cuid())
  type        ReviewType

  authorId    String
  author      User         @relation("ReviewAuthor", fields: [authorId], references: [id], onDelete: Cascade)

  // For Plot Reviews
  plotId      String?
  plot        Plot?        @relation(fields: [plotId], references: [id], onDelete: Cascade)

  // For User Reviews
  subjectId   String?
  subject     User?        @relation("ReviewSubject", fields: [subjectId], references: [id], onDelete: Cascade)

  // For Tool Rental Reviews
  toolRentalId String?
  toolRental   ToolRental? @relation(fields: [toolRentalId], references: [id], onDelete: Cascade)

  rating      Int          // 1-5
  title       String?
  content     String

  // Response
  response    String?
  respondedAt DateTime?

  isPublic    Boolean      @default(true)

  // Helpful votes
  votes       ReviewVote[]
  helpfulCount    Int      @default(0)
  notHelpfulCount Int      @default(0)

  // Reports
  reports     Report[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([authorId])
  @@index([plotId])
  @@index([subjectId])
  @@index([type])
}

model ReviewVote {
  id        String   @id @default(cuid())
  reviewId  String
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  value     Int      // 1 for helpful, -1 for not helpful
  createdAt DateTime @default(now())

  @@unique([userId, reviewId])
  @@index([reviewId])
  @@index([userId])
}

// ============================================
// CO-OP MARKETPLACE / TRADING POST
// ============================================

enum ProduceStatus {
  AVAILABLE
  RESERVED
  SOLD
  UNAVAILABLE
}

enum DeliveryMethod {
  PICKUP
  DELIVERY
  SHIPPING
  CENTRAL_DROP
}

model ProduceListing {
  id              String          @id @default(cuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Product Info
  productName     String
  variety         String?
  description     String
  category        String          // vegetables, fruits, herbs, etc.

  // Quantity & Pricing
  quantity        Float           // in pounds
  unit            String          @default("lb")
  pricePerUnit    Float

  // Availability
  status          ProduceStatus   @default(AVAILABLE)
  availableDate   DateTime
  expiresDate     DateTime?

  // Delivery
  deliveryMethods DeliveryMethod[]
  pickupLocation  String?
  deliveryRadius  Int?            // miles

  // Media
  images          String[]

  // Organic/Certification
  isOrganic       Boolean         @default(false)
  isCertified     Boolean         @default(false)
  certifications  String[]

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  orders          Order[]
  reports         Report[]

  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([availableDate])
}

enum OrderStatus {
  PENDING
  CONFIRMED
  READY
  COMPLETED
  CANCELLED
}

model Order {
  id              String          @id @default(cuid())
  listingId       String
  listing         ProduceListing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  buyerId         String
  buyer           User            @relation(fields: [buyerId], references: [id], onDelete: Cascade)

  quantity        Float
  totalPrice      Float

  status          OrderStatus     @default(PENDING)
  deliveryMethod  DeliveryMethod
  deliveryAddress String?

  // Payment
  stripePaymentId String?
  paidAt          DateTime?

  // Fulfillment
  readyAt         DateTime?
  completedAt     DateTime?
  cancelledAt     DateTime?

  notes           String?

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  paymentIntent   PaymentIntent?

  @@index([listingId])
  @@index([buyerId])
  @@index([status])
}

// ============================================
// USER CONTENT & SOCIAL
// ============================================

enum PostType {
  BLOG
  TIP
  RECIPE
  VLOG
  UPDATE
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String   // User who is following
  followingId String   // User being followed

  follower    User     @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model UserPost {
  id          String     @id @default(cuid())
  authorId    String
  author      User       @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title       String
  slug        String     @unique
  content     String     // Rich text content
  excerpt     String?    // Short summary

  type        PostType   @default(BLOG)
  status      PostStatus @default(PUBLISHED)

  // Media
  coverImage  String?
  images      String[]   // Array of image URLs
  videoUrl    String?

  // Engagement
  views       Int        @default(0)
  likes       Int        @default(0)

  // SEO & Discovery
  tags        String[]

  // Timestamps
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  comments    PostComment[]

  @@index([authorId])
  @@index([slug])
  @@index([status])
  @@index([type])
  @@index([publishedAt])
}

model PostComment {
  id        String   @id @default(cuid())
  postId    String
  post      UserPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  content   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([authorId])
  @@index([createdAt])
}

// ============================================
// EMAIL NOTIFICATIONS
// ============================================

model EmailPreferences {
  id                String  @id @default(cuid())
  userId            String  @unique
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Notification preferences
  bookingRequests   Boolean @default(true)
  bookingUpdates    Boolean @default(true)
  newMessages       Boolean @default(true)
  newReviews        Boolean @default(true)
  marketplaceOrders Boolean @default(true)
  forumReplies      Boolean @default(true)
  weeklyDigest      Boolean @default(true)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// In-app notification preferences
model NotificationPreferences {
  id                    String  @id @default(cuid())
  userId                String  @unique
  user                  User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // In-app notification preferences
  bookingRequests       Boolean @default(true)
  bookingUpdates        Boolean @default(true)
  newMessages           Boolean @default(true)
  newReviews            Boolean @default(true)
  marketplaceActivity   Boolean @default(true)
  forumActivity         Boolean @default(true)
  courseUpdates         Boolean @default(true)
  communityActivity     Boolean @default(true)  // Tips, events, groups
  systemAnnouncements   Boolean @default(true)

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// ============================================
// COMMUNITY FORUMS
// ============================================

enum ForumCategory {
  GENERAL_DISCUSSION
  GROWING_TIPS
  PEST_DISEASE
  EQUIPMENT_TOOLS
  RECIPES_COOKING
  MARKETPLACE_HELP
  INTRODUCTIONS
  EVENTS_MEETUPS
}

model ForumTopic {
  id          String        @id @default(cuid())
  authorId    String
  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title       String
  content     String
  category    ForumCategory
  tags        String[]

  isPinned    Boolean       @default(false)
  isSolved    Boolean       @default(false)
  isLocked    Boolean       @default(false)

  views       Int           @default(0)

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  replies     ForumReply[]
  votes       ForumVote[]   @relation("TopicVotes")

  @@index([authorId])
  @@index([category])
  @@index([createdAt])
}

model ForumReply {
  id          String       @id @default(cuid())
  topicId     String
  topic       ForumTopic   @relation(fields: [topicId], references: [id], onDelete: Cascade)
  authorId    String
  author      User         @relation(fields: [authorId], references: [id], onDelete: Cascade)

  parentId    String?      // For threaded replies
  content     String
  isAccepted  Boolean      @default(false)

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  votes       ForumVote[]  @relation("ReplyVotes")

  @@index([topicId])
  @@index([authorId])
  @@index([parentId])
}

model ForumVote {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  topicId     String?
  topic       ForumTopic?  @relation("TopicVotes", fields: [topicId], references: [id], onDelete: Cascade)
  replyId     String?
  reply       ForumReply?  @relation("ReplyVotes", fields: [replyId], references: [id], onDelete: Cascade)

  value       Int          // +1 or -1

  createdAt   DateTime     @default(now())

  @@unique([userId, topicId])
  @@unique([userId, replyId])
  @@index([topicId])
  @@index([replyId])
}

// ============================================
// COMMUNITY TIPS & CONTRIBUTIONS
// ============================================

enum TipCategory {
  PLANTING_CALENDAR
  PEST_DISEASE
  COMPANION_PLANTING
}

enum TipStatus {
  PENDING
  APPROVED
  REJECTED
}

model CommunityTip {
  id          String      @id @default(cuid())
  authorId    String
  author      User        @relation(fields: [authorId], references: [id], onDelete: Cascade)

  category    TipCategory
  title       String
  content     String

  // For planting calendar tips
  plantName   String?     // e.g., "Tomatoes"
  usdaZone    String?     // e.g., "5b", "7a"

  // For pest/disease tips
  pestName    String?     // e.g., "Aphids", "Powdery Mildew"
  treatment   String?     // Treatment method

  // For companion planting tips
  mainPlant   String?     // Primary plant
  companions  String[]    // Good companion plants
  avoid       String[]    // Plants to avoid

  // Moderation
  status      TipStatus   @default(PENDING)
  reviewedBy  String?
  reviewNotes String?
  reviewedAt  DateTime?

  // Engagement
  upvotes     Int         @default(0)
  downvotes   Int         @default(0)

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  votes       CommunityTipVote[]

  @@index([authorId])
  @@index([category])
  @@index([status])
  @@index([createdAt])
}

model CommunityTipVote {
  id        String        @id @default(cuid())
  tipId     String
  tip       CommunityTip  @relation(fields: [tipId], references: [id], onDelete: Cascade)
  userId    String
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  value     Int           // 1 for upvote, -1 for downvote

  createdAt DateTime      @default(now())

  @@unique([tipId, userId])
  @@index([tipId])
  @@index([userId])
}

// ============================================
// TOOL RENTAL SYSTEM
// ============================================

enum ToolCategory {
  HAND_TOOLS
  POWER_TOOLS
  IRRIGATION
  SOIL_COMPOST
  HARVESTING
  STORAGE
  OTHER
}

enum ToolCondition {
  EXCELLENT
  GOOD
  FAIR
  NEEDS_REPAIR
}

enum ToolListingType {
  RENT
  SALE
  BOTH
}

enum ToolStatus {
  AVAILABLE
  RENTED
  SOLD
  PENDING
  MAINTENANCE
}

enum RentalStatus {
  PENDING
  APPROVED
  ACTIVE
  COMPLETED
  CANCELLED
}

model Tool {
  id              String          @id @default(cuid())
  ownerId         String
  owner           User            @relation("ToolOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  name            String
  description     String
  category        ToolCategory
  condition       ToolCondition
  images          String[]

  listingType     ToolListingType @default(RENT)
  salePrice       Float?
  dailyRate       Float?
  weeklyRate      Float?
  depositRequired Float?

  status          ToolStatus      @default(AVAILABLE)

  // Location
  location        String?
  availableFrom   DateTime?
  availableTo     DateTime?

  // Timestamps
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  rentals         ToolRental[]

  @@index([ownerId])
  @@index([status])
  @@index([category])
}

model ToolRental {
  id              String        @id @default(cuid())
  toolId          String
  tool            Tool          @relation(fields: [toolId], references: [id], onDelete: Cascade)
  renterId        String
  renter          User          @relation("ToolRenter", fields: [renterId], references: [id], onDelete: Cascade)

  startDate       DateTime
  endDate         DateTime
  dailyRate       Float
  totalCost       Float
  depositAmount   Float?

  status          RentalStatus  @default(PENDING)

  // Check-in/out
  pickedUpAt      DateTime?
  returnedAt      DateTime?

  // Notes
  renterNotes     String?
  ownerNotes      String?

  // Reports
  reports         Report[]

  // Reviews
  reviews         Review[]

  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  approvedAt      DateTime?
  cancelledAt     DateTime?

  @@index([toolId])
  @@index([renterId])
  @@index([status])
}

// ============================================
// SYSTEM & CONFIGURATION
// ============================================

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  updatedAt   DateTime @updatedAt
}

// ============================================
// COMMUNITY GROUPS
// ============================================

model CommunityGroup {
  id              String   @id @default(cuid())
  name            String
  slug            String   @unique
  description     String
  coverImage      String?
  icon            String?

  // Location
  city            String?
  state           String?
  country         String   @default("USA")

  // Settings
  isPublic        Boolean  @default(true)
  requiresApproval Boolean @default(false)

  // Metadata
  tags            String[]

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  creatorId       String
  creator         User     @relation("GroupCreator", fields: [creatorId], references: [id])
  members         GroupMember[]
  events          GroupEvent[]
  posts           GroupPost[]

  @@index([creatorId])
  @@index([city, state])
  @@index([isPublic])
}

enum GroupRole {
  MEMBER
  MODERATOR
  ADMIN
}

model GroupMember {
  id        String    @id @default(cuid())
  groupId   String
  group     CommunityGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  role      GroupRole @default(MEMBER)
  joinedAt  DateTime  @default(now())

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model GroupEvent {
  id          String   @id @default(cuid())
  groupId     String
  group       CommunityGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  hostId      String
  host        User     @relation("GroupEventHost", fields: [hostId], references: [id])

  title       String
  description String
  location    String?
  startTime   DateTime
  endTime     DateTime?
  maxAttendees Int?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  attendees   GroupEventAttendee[]

  @@index([groupId])
  @@index([hostId])
  @@index([startTime])
}

model GroupEventAttendee {
  id        String     @id @default(cuid())
  eventId   String
  event     GroupEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  rsvpAt    DateTime   @default(now())

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

model GroupPost {
  id        String         @id @default(cuid())
  groupId   String
  group     CommunityGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  authorId  String
  author    User           @relation("GroupPostAuthor", fields: [authorId], references: [id])

  content   String
  images    String[]

  // Reports
  reports   Report[]

  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@index([groupId])
  @@index([authorId])
  @@index([createdAt])
}

// ============================================
// CHALLENGES & QUESTS
// ============================================

enum ChallengeDifficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum ChallengeStatus {
  DRAFT
  UPCOMING
  ACTIVE
  COMPLETED
  CANCELLED
}

enum ChallengeSeason {
  SPRING
  SUMMER
  FALL
  WINTER
  YEAR_ROUND
}

model Challenge {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  description     String
  longDescription String?
  coverImage      String?

  difficulty      ChallengeDifficulty @default(BEGINNER)
  season          ChallengeSeason @default(YEAR_ROUND)
  status          ChallengeStatus @default(DRAFT)

  // Timing
  startDate       DateTime
  endDate         DateTime

  // Requirements
  requirements    Json?    // Array of requirement objects

  // Rewards
  pointsReward    Int      @default(100)
  badgeId         String?
  badge           Badge?   @relation(fields: [badgeId], references: [id])

  // Metadata
  tags            String[]
  maxParticipants Int?

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  creatorId       String
  creator         User     @relation("ChallengeCreator", fields: [creatorId], references: [id])
  participants    ChallengeParticipant[]

  @@index([creatorId])
  @@index([status])
  @@index([startDate, endDate])
  @@index([season])
}

enum ParticipantStatus {
  JOINED
  IN_PROGRESS
  COMPLETED
  DROPPED
}

model ChallengeParticipant {
  id           String   @id @default(cuid())
  challengeId  String
  challenge    Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  status       ParticipantStatus @default(JOINED)
  progress     Int      @default(0)  // 0-100 percentage
  progressData Json?    // Detailed progress tracking

  joinedAt     DateTime @default(now())
  completedAt  DateTime?

  @@unique([challengeId, userId])
  @@index([challengeId])
  @@index([userId])
  @@index([status])
}

// ============================================
// CONTENT MODERATION
// ============================================

enum ReportType {
  PLOT
  REVIEW
  MESSAGE
  LISTING
  TOOL
  FORUM_POST
  USER
}

enum ReportStatus {
  PENDING
  RESOLVED
  DISMISSED
}

enum ReportReason {
  SPAM
  INAPPROPRIATE
  HARASSMENT
  FRAUD
  MISLEADING
  SAFETY
  OTHER
}

model Report {
  id          String       @id @default(cuid())

  type        ReportType
  reason      ReportReason
  status      ReportStatus @default(PENDING)
  details     String?      // Additional details from reporter

  // Reporter
  reporterId  String
  reporter    User         @relation("ReportedBy", fields: [reporterId], references: [id], onDelete: Cascade)

  // Reported content IDs (only one will be set based on type)
  plotId      String?
  plot        Plot?        @relation(fields: [plotId], references: [id], onDelete: SetNull)
  reviewId    String?
  review      Review?      @relation(fields: [reviewId], references: [id], onDelete: SetNull)
  messageId   String?
  message     Message?     @relation(fields: [messageId], references: [id], onDelete: SetNull)
  listingId   String?
  listing     ProduceListing? @relation(fields: [listingId], references: [id], onDelete: SetNull)
  toolId      String?
  tool        ToolRental?  @relation(fields: [toolId], references: [id], onDelete: SetNull)
  postId      String?
  post        GroupPost?   @relation(fields: [postId], references: [id], onDelete: SetNull)
  userId      String?      // For reporting users
  reportedUser User?       @relation("ReportedUser", fields: [userId], references: [id], onDelete: SetNull)

  // Resolution
  resolvedBy   String?
  resolvedAt   DateTime?
  resolution   String?      // Notes about how it was resolved
  actionTaken  String?      // e.g., "content_removed", "user_warned", "none"

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([reporterId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
}

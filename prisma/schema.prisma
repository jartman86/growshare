// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER MANAGEMENT
// ============================================

enum UserRole {
  LANDOWNER
  RENTER
  BUYER
  ORGANIZATION
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  INACTIVE
}

model User {
  id                String      @id @default(cuid())
  clerkId           String      @unique
  email             String      @unique
  username          String?     @unique
  firstName         String
  lastName          String
  phoneNumber       String?
  avatar            String?
  coverImage        String?
  bio               String?
  location          String?
  website           String?
  socialLinks       Json?
  role              UserRole[]  @default([RENTER])
  status            UserStatus  @default(ACTIVE)

  // Verification
  isVerified        Boolean     @default(false)
  verifiedAt        DateTime?

  // Gamification
  totalPoints       Int         @default(0)
  level             Int         @default(1)

  // Preferences
  preferredLanguage String      @default("en")
  timezone          String      @default("America/New_York")

  // Stripe Integration
  stripeCustomerId         String?  @unique
  stripeConnectId          String?  @unique
  stripeOnboardingComplete Boolean  @default(false)

  // Timestamps
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  lastLoginAt       DateTime?

  // Relations
  ownedPlots        Plot[]              @relation("PlotOwner")
  rentedPlots       Booking[]           @relation("PlotRenter")
  cropJournals      CropJournal[]
  userBadges        UserBadge[]
  courseProgress    CourseProgress[]
  sentMessages      Message[]           @relation("MessageSender")
  receivedMessages  Message[]           @relation("MessageReceiver")
  reviews           Review[]            @relation("ReviewAuthor")
  receivedReviews   Review[]            @relation("ReviewSubject")
  produceListings   ProduceListing[]
  orders            Order[]
  activities        UserActivity[]
  notifications     Notification[]
  posts             UserPost[]
  postComments      PostComment[]
  following         Follow[]         @relation("UserFollowing")
  followers         Follow[]         @relation("UserFollowers")
  ownedTools        Tool[]           @relation("ToolOwner")
  toolRentals       ToolRental[]     @relation("ToolRenter")
  forumTopics       ForumTopic[]
  forumReplies      ForumReply[]
  forumVotes        ForumVote[]
  reviewVotes       ReviewVote[]
  emailPreferences  EmailPreferences?

  @@index([clerkId])
  @@index([email])
  @@index([username])
  @@index([status])
}

// ============================================
// LAND & PLOT MANAGEMENT
// ============================================

enum PlotStatus {
  DRAFT
  ACTIVE
  RENTED
  INACTIVE
  ARCHIVED
}

enum SoilType {
  CLAY
  SANDY
  LOAM
  SILT
  PEAT
  CHALK
}

enum WaterAccess {
  NONE
  WELL
  MUNICIPAL
  POND
  STREAM
  IRRIGATION
}

model Plot {
  id                String        @id @default(cuid())
  ownerId           String
  owner             User          @relation("PlotOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  // Basic Info
  title             String
  description       String
  status            PlotStatus    @default(DRAFT)

  // Location
  address           String
  city              String
  state             String
  zipCode           String
  county            String?
  latitude          Float
  longitude         Float

  // Plot Details
  acreage           Float
  soilType          SoilType[]
  soilPH            Float?
  waterAccess       WaterAccess[]
  usdaZone          String?
  sunExposure       String?       // full, partial, shade

  // Features
  hasFencing        Boolean       @default(false)
  hasGreenhouse     Boolean       @default(false)
  hasToolStorage    Boolean       @default(false)
  hasElectricity    Boolean       @default(false)
  hasRoadAccess     Boolean       @default(false)
  hasIrrigation     Boolean       @default(false)
  isADAAccessible   Boolean       @default(false)

  // Additional Details
  allowsLivestock   Boolean       @default(false)
  allowsStructures  Boolean       @default(false)
  restrictions      String?

  // Pricing
  pricePerMonth     Float
  pricePerSeason    Float?
  pricePerYear      Float?
  securityDeposit   Float?

  // Booking
  instantBook       Boolean       @default(false)
  minimumLease      Int           @default(3)  // months

  // Media
  images            String[]
  droneFootageUrl   String?
  virtualTourUrl    String?

  // Stats
  viewCount         Int           @default(0)
  bookingCount      Int           @default(0)
  averageRating     Float?

  // Timestamps
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  publishedAt       DateTime?

  // Relations
  bookings          Booking[]
  amenities         PlotAmenity[]
  soilTests         SoilTest[]
  reviews           Review[]
  blockedDates      PlotBlockedDate[]

  @@index([ownerId])
  @@index([status])
  @@index([city, state])
  @@index([latitude, longitude])
}

model PlotBlockedDate {
  id          String   @id @default(cuid())
  plotId      String
  plot        Plot     @relation(fields: [plotId], references: [id], onDelete: Cascade)
  startDate   DateTime
  endDate     DateTime
  reason      String?  // e.g., "maintenance", "personal use", "seasonal closure"
  createdAt   DateTime @default(now())

  @@index([plotId])
  @@index([startDate, endDate])
}

model PlotAmenity {
  id          String   @id @default(cuid())
  plotId      String
  plot        Plot     @relation(fields: [plotId], references: [id], onDelete: Cascade)
  name        String
  description String?
  price       Float?   // Optional add-on price
  createdAt   DateTime @default(now())

  @@index([plotId])
}

model SoilTest {
  id          String   @id @default(cuid())
  plotId      String
  plot        Plot     @relation(fields: [plotId], references: [id], onDelete: Cascade)
  testDate    DateTime
  pH          Float?
  nitrogen    Float?
  phosphorus  Float?
  potassium   Float?
  organicMatter Float?
  results     Json?    // Full test results
  pdfUrl      String?
  createdAt   DateTime @default(now())

  @@index([plotId])
}

// ============================================
// BOOKING & RENTAL MANAGEMENT
// ============================================

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
  ACTIVE
  COMPLETED
  CANCELLED
}

model Booking {
  id              String        @id @default(cuid())
  plotId          String
  plot            Plot          @relation(fields: [plotId], references: [id], onDelete: Cascade)
  renterId        String
  renter          User          @relation("PlotRenter", fields: [renterId], references: [id], onDelete: Cascade)

  status          BookingStatus @default(PENDING)

  // Dates
  startDate       DateTime
  endDate         DateTime

  // Pricing
  monthlyRate     Float
  totalAmount     Float
  securityDeposit Float?

  // Payment
  stripePaymentId String?
  paidAt          DateTime?

  // Agreement
  leaseUrl        String?
  signedAt        DateTime?

  // Check-in/out
  checkedInAt     DateTime?
  checkedOutAt    DateTime?

  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  approvedAt      DateTime?
  rejectedAt      DateTime?
  cancelledAt     DateTime?

  // Relations
  messages        Message[]
  paymentIntent   PaymentIntent?

  @@index([plotId])
  @@index([renterId])
  @@index([status])
  @@index([startDate, endDate])
}

// ============================================
// PAYMENT SYSTEM
// ============================================

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELLED
  REFUNDED
}

model PaymentIntent {
  id                    String        @id @default(cuid())
  stripePaymentIntentId String        @unique
  amount                Int           // Amount in cents
  currency              String        @default("usd")
  status                PaymentStatus @default(PENDING)

  // Related entities (one or the other)
  bookingId             String?       @unique
  booking               Booking?      @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  orderId               String?       @unique
  order                 Order?        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  // Metadata
  metadata              Json?
  failureMessage        String?

  // Timestamps
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  completedAt           DateTime?

  @@index([stripePaymentIntentId])
  @@index([status])
}

// ============================================
// GAMIFICATION SYSTEM
// ============================================

enum BadgeCategory {
  MILESTONE
  SKILL
  COMMUNITY
  PRODUCTION
  STEWARDSHIP
}

enum BadgeTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

model Badge {
  id          String        @id @default(cuid())
  name        String        @unique
  description String
  category    BadgeCategory
  tier        BadgeTier     @default(BRONZE)
  icon        String
  points      Int           @default(0)
  criteria    Json          // JSON describing how to earn this badge
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())

  // Relations
  userBadges  UserBadge[]

  @@index([category])
}

model UserBadge {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badgeId     String
  badge       Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  earnedAt    DateTime @default(now())

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
}

enum ActivityType {
  PLOT_LISTED
  PLOT_RENTED
  BOOKING_CREATED
  BOOKING_APPROVED
  BOOKING_REJECTED
  BOOKING_CANCELLED
  REVIEW_CREATED
  REVIEW_RECEIVED
  FIRST_HARVEST
  JOURNAL_ENTRY
  COURSE_COMPLETED
  BADGE_EARNED
  PRODUCE_SOLD
  MILESTONE_REACHED
  POST_CREATED
  NEW_FOLLOWER
}

model UserActivity {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        ActivityType
  title       String
  description String?
  points      Int          @default(0)
  metadata    Json?
  createdAt   DateTime     @default(now())

  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

// ============================================
// CROP JOURNAL & FARMING TRACKING
// ============================================

enum CropStage {
  PLANNING
  PLANTED
  GERMINATED
  GROWING
  FLOWERING
  FRUITING
  HARVESTING
  COMPLETED
}

model CropJournal {
  id              String     @id @default(cuid())
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Crop Info
  cropName        String
  variety         String?
  plantedDate     DateTime?
  expectedHarvest DateTime?
  stage           CropStage  @default(PLANNING)

  // Journal Entry
  title           String
  content         String
  images          String[]

  // Tracking
  plantCount      Int?
  areaUsed        Float?     // square feet

  // Weather Data
  weatherData     Json?
  weatherLocation String?

  // Timestamps
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  // Relations
  harvests        Harvest[]

  @@index([userId])
  @@index([stage])
}

model Harvest {
  id              String      @id @default(cuid())
  cropJournalId   String
  cropJournal     CropJournal @relation(fields: [cropJournalId], references: [id], onDelete: Cascade)

  harvestDate     DateTime
  quantity        Float       // in pounds
  quality         String?     // excellent, good, fair, poor
  notes           String?

  createdAt       DateTime    @default(now())

  @@index([cropJournalId])
  @@index([harvestDate])
}

// ============================================
// KNOWLEDGE HUB & EDUCATION
// ============================================

enum CourseCategory {
  SOIL_SCIENCE
  CROP_GUIDES
  PEST_MANAGEMENT
  FARMING_METHODS
  ANIMAL_HUSBANDRY
  BUSINESS_LEGAL
  CLIMATE_ADAPTATION
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model Course {
  id              String          @id @default(cuid())
  title           String
  description     String
  category        CourseCategory
  level           CourseLevel     @default(BEGINNER)

  // Content
  thumbnailUrl    String?
  duration        Int?            // minutes
  pointsAwarded   Int             @default(0)

  // Certification
  isCertification Boolean         @default(false)
  certificateName String?

  isPublished     Boolean         @default(false)

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  modules         CourseModule[]
  progress        CourseProgress[]

  @@index([category])
  @@index([isPublished])
}

model CourseModule {
  id          String   @id @default(cuid())
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  title       String
  description String?
  content     String   // Markdown or HTML
  videoUrl    String?
  order       Int

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([courseId])
}

model CourseProgress {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId        String
  course          Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)

  startedAt       DateTime  @default(now())
  completedAt     DateTime?
  progressPercent Int       @default(0)

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
}

// ============================================
// MESSAGING SYSTEM
// ============================================

model Message {
  id          String   @id @default(cuid())
  senderId    String
  sender      User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiverId  String
  receiver    User     @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  bookingId   String?
  booking     Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  subject     String?
  content     String

  isRead      Boolean  @default(false)
  readAt      DateTime?

  createdAt   DateTime @default(now())

  @@index([senderId])
  @@index([receiverId])
  @@index([bookingId])
  @@index([createdAt])
}

// ============================================
// NOTIFICATION SYSTEM
// ============================================

enum NotificationType {
  BOOKING_REQUEST
  BOOKING_APPROVED
  BOOKING_REJECTED
  BOOKING_CANCELLED
  NEW_MESSAGE
  NEW_REVIEW
  PAYMENT_RECEIVED
  PLOT_VIEWED
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      NotificationType
  title     String
  content   String
  link      String?

  isRead    Boolean          @default(false)
  readAt    DateTime?

  metadata  Json?

  createdAt DateTime         @default(now())

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

// ============================================
// REVIEW & RATING SYSTEM
// ============================================

enum ReviewType {
  PLOT
  USER
}

model Review {
  id          String       @id @default(cuid())
  type        ReviewType

  authorId    String
  author      User         @relation("ReviewAuthor", fields: [authorId], references: [id], onDelete: Cascade)

  // For Plot Reviews
  plotId      String?
  plot        Plot?        @relation(fields: [plotId], references: [id], onDelete: Cascade)

  // For User Reviews
  subjectId   String?
  subject     User?        @relation("ReviewSubject", fields: [subjectId], references: [id], onDelete: Cascade)

  rating      Int          // 1-5
  title       String?
  content     String

  // Response
  response    String?
  respondedAt DateTime?

  isPublic    Boolean      @default(true)

  // Helpful votes
  votes       ReviewVote[]
  helpfulCount    Int      @default(0)
  notHelpfulCount Int      @default(0)

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([authorId])
  @@index([plotId])
  @@index([subjectId])
  @@index([type])
}

model ReviewVote {
  id        String   @id @default(cuid())
  reviewId  String
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  value     Int      // 1 for helpful, -1 for not helpful
  createdAt DateTime @default(now())

  @@unique([userId, reviewId])
  @@index([reviewId])
  @@index([userId])
}

// ============================================
// CO-OP MARKETPLACE / TRADING POST
// ============================================

enum ProduceStatus {
  AVAILABLE
  RESERVED
  SOLD
  UNAVAILABLE
}

enum DeliveryMethod {
  PICKUP
  DELIVERY
  CENTRAL_DROP
}

model ProduceListing {
  id              String          @id @default(cuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Product Info
  productName     String
  variety         String?
  description     String
  category        String          // vegetables, fruits, herbs, etc.

  // Quantity & Pricing
  quantity        Float           // in pounds
  unit            String          @default("lb")
  pricePerUnit    Float

  // Availability
  status          ProduceStatus   @default(AVAILABLE)
  availableDate   DateTime
  expiresDate     DateTime?

  // Delivery
  deliveryMethods DeliveryMethod[]
  pickupLocation  String?
  deliveryRadius  Int?            // miles

  // Media
  images          String[]

  // Organic/Certification
  isOrganic       Boolean         @default(false)
  isCertified     Boolean         @default(false)
  certifications  String[]

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  orders          Order[]

  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([availableDate])
}

enum OrderStatus {
  PENDING
  CONFIRMED
  READY
  COMPLETED
  CANCELLED
}

model Order {
  id              String          @id @default(cuid())
  listingId       String
  listing         ProduceListing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  buyerId         String
  buyer           User            @relation(fields: [buyerId], references: [id], onDelete: Cascade)

  quantity        Float
  totalPrice      Float

  status          OrderStatus     @default(PENDING)
  deliveryMethod  DeliveryMethod
  deliveryAddress String?

  // Payment
  stripePaymentId String?
  paidAt          DateTime?

  // Fulfillment
  readyAt         DateTime?
  completedAt     DateTime?
  cancelledAt     DateTime?

  notes           String?

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  paymentIntent   PaymentIntent?

  @@index([listingId])
  @@index([buyerId])
  @@index([status])
}

// ============================================
// USER CONTENT & SOCIAL
// ============================================

enum PostType {
  BLOG
  TIP
  RECIPE
  VLOG
  UPDATE
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String   // User who is following
  followingId String   // User being followed

  follower    User     @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model UserPost {
  id          String     @id @default(cuid())
  authorId    String
  author      User       @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title       String
  slug        String     @unique
  content     String     // Rich text content
  excerpt     String?    // Short summary

  type        PostType   @default(BLOG)
  status      PostStatus @default(PUBLISHED)

  // Media
  coverImage  String?
  images      String[]   // Array of image URLs
  videoUrl    String?

  // Engagement
  views       Int        @default(0)
  likes       Int        @default(0)

  // SEO & Discovery
  tags        String[]

  // Timestamps
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  comments    PostComment[]

  @@index([authorId])
  @@index([slug])
  @@index([status])
  @@index([type])
  @@index([publishedAt])
}

model PostComment {
  id        String   @id @default(cuid())
  postId    String
  post      UserPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  content   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([authorId])
  @@index([createdAt])
}

// ============================================
// EMAIL NOTIFICATIONS
// ============================================

model EmailPreferences {
  id                String  @id @default(cuid())
  userId            String  @unique
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Notification preferences
  bookingRequests   Boolean @default(true)
  bookingUpdates    Boolean @default(true)
  newMessages       Boolean @default(true)
  newReviews        Boolean @default(true)
  marketplaceOrders Boolean @default(true)
  forumReplies      Boolean @default(true)
  weeklyDigest      Boolean @default(true)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

// ============================================
// COMMUNITY FORUMS
// ============================================

enum ForumCategory {
  GENERAL_DISCUSSION
  GROWING_TIPS
  PEST_DISEASE
  EQUIPMENT_TOOLS
  RECIPES_COOKING
  MARKETPLACE_HELP
  INTRODUCTIONS
  EVENTS_MEETUPS
}

model ForumTopic {
  id          String        @id @default(cuid())
  authorId    String
  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title       String
  content     String
  category    ForumCategory
  tags        String[]

  isPinned    Boolean       @default(false)
  isSolved    Boolean       @default(false)
  isLocked    Boolean       @default(false)

  views       Int           @default(0)

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  replies     ForumReply[]
  votes       ForumVote[]   @relation("TopicVotes")

  @@index([authorId])
  @@index([category])
  @@index([createdAt])
}

model ForumReply {
  id          String       @id @default(cuid())
  topicId     String
  topic       ForumTopic   @relation(fields: [topicId], references: [id], onDelete: Cascade)
  authorId    String
  author      User         @relation(fields: [authorId], references: [id], onDelete: Cascade)

  parentId    String?      // For threaded replies
  content     String
  isAccepted  Boolean      @default(false)

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  votes       ForumVote[]  @relation("ReplyVotes")

  @@index([topicId])
  @@index([authorId])
  @@index([parentId])
}

model ForumVote {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  topicId     String?
  topic       ForumTopic?  @relation("TopicVotes", fields: [topicId], references: [id], onDelete: Cascade)
  replyId     String?
  reply       ForumReply?  @relation("ReplyVotes", fields: [replyId], references: [id], onDelete: Cascade)

  value       Int          // +1 or -1

  createdAt   DateTime     @default(now())

  @@unique([userId, topicId])
  @@unique([userId, replyId])
  @@index([topicId])
  @@index([replyId])
}

// ============================================
// TOOL RENTAL SYSTEM
// ============================================

enum ToolCategory {
  HAND_TOOLS
  POWER_TOOLS
  IRRIGATION
  SOIL_COMPOST
  HARVESTING
  STORAGE
  OTHER
}

enum ToolCondition {
  EXCELLENT
  GOOD
  FAIR
  NEEDS_REPAIR
}

enum ToolListingType {
  RENT
  SALE
  BOTH
}

enum ToolStatus {
  AVAILABLE
  RENTED
  SOLD
  PENDING
  MAINTENANCE
}

enum RentalStatus {
  PENDING
  APPROVED
  ACTIVE
  COMPLETED
  CANCELLED
}

model Tool {
  id              String          @id @default(cuid())
  ownerId         String
  owner           User            @relation("ToolOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  name            String
  description     String
  category        ToolCategory
  condition       ToolCondition
  images          String[]

  listingType     ToolListingType @default(RENT)
  salePrice       Float?
  dailyRate       Float?
  weeklyRate      Float?
  depositRequired Float?

  status          ToolStatus      @default(AVAILABLE)

  // Location
  location        String?
  availableFrom   DateTime?
  availableTo     DateTime?

  // Timestamps
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  rentals         ToolRental[]

  @@index([ownerId])
  @@index([status])
  @@index([category])
}

model ToolRental {
  id              String        @id @default(cuid())
  toolId          String
  tool            Tool          @relation(fields: [toolId], references: [id], onDelete: Cascade)
  renterId        String
  renter          User          @relation("ToolRenter", fields: [renterId], references: [id], onDelete: Cascade)

  startDate       DateTime
  endDate         DateTime
  dailyRate       Float
  totalCost       Float
  depositAmount   Float?

  status          RentalStatus  @default(PENDING)

  // Check-in/out
  pickedUpAt      DateTime?
  returnedAt      DateTime?

  // Notes
  renterNotes     String?
  ownerNotes      String?

  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  approvedAt      DateTime?
  cancelledAt     DateTime?

  @@index([toolId])
  @@index([renterId])
  @@index([status])
}

// ============================================
// SYSTEM & CONFIGURATION
// ============================================

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  updatedAt   DateTime @updatedAt
}
